<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>CSS Inspector è°ƒè¯•åŠ©æ‰‹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .debug-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      color: #333;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      background: #4A90E2;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #357ABD;
    }
    .log {
      background: #000;
      color: #0f0;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Monaco', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .log-entry {
      margin: 2px 0;
    }
    .error { color: #ff4444; }
    .success { color: #00ff00; }
    .info { color: #00aaff; }
    .warning { color: #ffaa00; }
  </style>
</head>
<body>
  <div class="debug-panel">
    <h2>ğŸ” CSS Inspector è°ƒè¯•åŠ©æ‰‹</h2>
    <p>è¿™ä¸ªé¡µé¢å¯ä»¥å¸®åŠ©ä½ è¯Šæ–­ CSS Inspector æ‰©å±•çš„é—®é¢˜ã€‚</p>
    
    <div>
      <button onclick="checkContentScript()">1ï¸âƒ£ æ£€æŸ¥ Content Script</button>
      <button onclick="checkPanel()">2ï¸âƒ£ æ£€æŸ¥ Panel</button>
      <button onclick="testPickingMode()">3ï¸âƒ£ æµ‹è¯•é€‰æ‹©æ¨¡å¼</button>
      <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="log" id="log"></div>
  </div>

  <div class="debug-panel">
    <h2>ğŸ“‹ æµ‹è¯•å…ƒç´ </h2>
    <div style="padding: 20px; background: #e3f2fd; border-radius: 4px; margin: 10px 0;">
      <h3 style="color: #1976d2;">æ ‡é¢˜å…ƒç´ </h3>
      <p style="color: #666;">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ®µè½ï¼Œä½ å¯ä»¥å°è¯•é€‰æ‹©å®ƒã€‚</p>
      <button style="background: #ff6b6b;">çº¢è‰²æŒ‰é’®</button>
      <button style="background: #51cf66;">ç»¿è‰²æŒ‰é’®</button>
    </div>
  </div>

  <script>
    const logEl = document.getElementById('log');
    
    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
      console.log(message);
    }

    function clearLog() {
      logEl.innerHTML = '';
      log('æ—¥å¿—å·²æ¸…ç©º', 'info');
    }

    // æ£€æŸ¥ Content Script
    async function checkContentScript() {
      log('=== å¼€å§‹æ£€æŸ¥ Content Script ===', 'info');
      
      try {
        // æ–¹æ³• 1: æ£€æŸ¥å…¨å±€æ ‡è®°
        if (window.__CSS_INSPECTOR_INJECTED__) {
          log('âœ… Content Script å·²æ³¨å…¥ï¼ˆå…¨å±€æ ‡è®°å­˜åœ¨ï¼‰', 'success');
        } else {
          log('âŒ Content Script æœªæ³¨å…¥ï¼ˆå…¨å±€æ ‡è®°ä¸å­˜åœ¨ï¼‰', 'error');
        }

        // æ–¹æ³• 2: æ£€æŸ¥æ˜¯å¦èƒ½å‘é€æ¶ˆæ¯
        log('æ­£åœ¨å°è¯• ping Content Script...', 'info');
        const response = await chrome.runtime.sendMessage({action: 'ping'});
        log(`âœ… Content Script å“åº”: ${JSON.stringify(response)}`, 'success');
        
      } catch (error) {
        log(`âŒ é”™è¯¯: ${error.message}`, 'error');
      }
    }

    // æ£€æŸ¥ Panel çŠ¶æ€
    async function checkPanel() {
      log('=== å¼€å§‹æ£€æŸ¥ Panel çŠ¶æ€ ===', 'info');
      
      try {
        // è·å–å½“å‰æ ‡ç­¾é¡µ
        const tabs = await chrome.tabs.query({active: true, currentWindow: true});
        log(`å½“å‰æ ‡ç­¾é¡µ ID: ${tabs[0].id}`, 'info');
        
        // å°è¯•æ‰“å¼€ Side Panel
        log('æ­£åœ¨å°è¯•æ‰“å¼€ Side Panel...', 'info');
        await chrome.sidePanel.open({windowId: chrome.windows.WINDOW_ID_CURRENT});
        log('âœ… Side Panel å·²æ‰“å¼€', 'success');
        
        log('æç¤º: è¯·æ£€æŸ¥ Side Panel æ˜¯å¦æ˜¾ç¤ºï¼Œå¹¶æŸ¥çœ‹å…¶ Console', 'warning');
        
      } catch (error) {
        log(`âŒ é”™è¯¯: ${error.message}`, 'error');
      }
    }

    // æµ‹è¯•é€‰æ‹©æ¨¡å¼
    async function testPickingMode() {
      log('=== å¼€å§‹æµ‹è¯•é€‰æ‹©æ¨¡å¼ ===', 'info');
      
      try {
        log('æ­£åœ¨å‘é€ startPicking æ¶ˆæ¯...', 'info');
        const response = await chrome.runtime.sendMessage({action: 'startPicking'});
        
        if (response && response.success) {
          log('âœ… é€‰æ‹©æ¨¡å¼å·²å¯åŠ¨', 'success');
          log('ç°åœ¨å°è¯•ç§»åŠ¨é¼ æ ‡åˆ°é¡µé¢å…ƒç´ ä¸Šï¼Œåº”è¯¥ä¼šçœ‹åˆ°è“è‰²é«˜äº®', 'info');
        } else {
          log(`âŒ å¯åŠ¨å¤±è´¥: ${JSON.stringify(response)}`, 'error');
        }
        
      } catch (error) {
        log(`âŒ é”™è¯¯: ${error.message}`, 'error');
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.addEventListener('load', () => {
      log('ğŸš€ è°ƒè¯•åŠ©æ‰‹å·²åŠ è½½', 'success');
      log('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è¯Šæ–­', 'info');
      
      // ç›‘å¬æ¥è‡ª Content Script çš„æ¶ˆæ¯
      window.addEventListener('message', (event) => {
        if (event.data.from === 'css-inspector') {
          log(`ğŸ“¨ æ”¶åˆ° Content Script æ¶ˆæ¯: ${JSON.stringify(event.data)}`, 'info');
        }
      });
    });
  </script>
</body>
</html>
